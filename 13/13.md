# 13장 스코프 Scope

## 13.1 스코프란

스코프는 변수 그리고 함수와 깊은 관련이 있다.

`var` 키워드와 `let` , `const` 키워드로 선언한 변수의 스코프는 다르게 동작한다. 여기서는 주로 `var`를 다루고 `let`과 `const`는 15장에서 다룰 것이다.

- 모든 식별자(변수, 함수, 클래스명)는 자신이 선언된 위치에 의해 다른 코드가 자신을 참조할 수 있는 '유효 범위', 즉 '스코프'가 결정된다.

```js
var x = "global";

function foo() {
  var x = "local";
  console.log(x); // 1)
}

foo();

console.log(x); // 2)
```

식별자는 유일<sup>unique</sup>해야한다. 따라서 하나의 식별자에는 하나의 값이 바인딩 되어야 한다.

1)에서 식별자 x가 참조할 값이 맨위에 있는 `'global'`일지 함수 안에 있는 `'local'`일지 결정해야 한다. 이를 Identifier resolution이라 한다.~~Spring프레임워크에선 뷰리졸버,핸들러리졸버 등으로 resolve용어를 쓴다.~~

> **_"var" vs "let, const" 키워드의 중복_** > `var` 키워드는 중복 선언을 허용한다. `var x = 1;`을 먼저 선언한 후에도 `var x = 2;`을 선언할 수 있으며, 최종적으로는 `x`에는 값 `2`가 할당된다.<br>
> 하지만 `let` 과 `const` 키워드는 중복 선언을 허용하지 않는다.

## 13.2 스코프의 종류

전역<sup>global</sup>과 지역<sup>local</sup>로 구분된다.

### 13.2.1 전역과 전역 스코프

전역이란 코드의 가장 바깥 영역을 말한다. 전역 변수는 어디서든지 참조 가능하다.

### 13.2.2 지역과 지역 스코프

지역이란 **함수 몸체 내부**를 말한다. 지역 변수는 자신의 **지역 스코프**와 **하위 지역 스코프**에서 유효하다.

## 13.3 스코프 체인

함수 내부에서 함수가 정의된 것을 함수의 중첩이라 하며, 내부에 정의된 함수를 중첩 함수<sup>nested function</sup>, 바깥을 외부 함수<sup>outer function</sup>라고 한다. 내부 함수가 하위 스코프로, 외부 함수가 상위 스코프가 되는 계층적 구조가 형성된다.

스코프가 계층적으로 연결된 것을 스코프 체인<sup>scope chain</sup>이라고 한다.

### 13.3.1 스코프 체인에 의한 변수 검색

스코프 체인이 존재하는 경우, JS 엔진은 변수를 참조할 때 동일 레벨의 스코프부터 탐색하기 시작한다. 참조할 변수가 없다면 상위 스코프로 이동한다. 최종적으로는 전역 스코프까지 이동하며, 존재하지 않는다면 에러가 발생한다.

하위 스코프로 탐색을 진행하지 않기 때문에 상위 스코프에서 하위 스코프의 변수를 참조할 수 없다.

### 13.3.2 스코프 체인에 의한 함수 검색

```js
// 전역 함수
function foo() {
  console.log("global function foo");
}

function bar() {
  // 중첩 함수
  function foo() {
    console.log("local function foo");
  }

  foo(); // 2)
}

bar(); // 1)

// local function foo
```

함수 호이스팅으로 인해 우선 런타임 전에 함수 객체에 대한 식별자가 생성된다. 1)에서 `bar`가 호출된 후 2)에서 `foo`를 호출하면 동일 스코프에 있는 함수 `foo()`가 실행된다.

## 13.4 함수 레벨 스코프

`var` 키워드는 이외의 코드블럭 `{ }`이 아닌 오로지 함수 코드 블럭만을 지역 스코프로 인정한다.

이러한 특성을 함수 레벨 스코프라 한다.

```js
var x = 1;

if (true) {
  var x = 10;
}

console.log(x); // 10
```

항상 예상할 수 있는 코드를 짜야한다. `var` 키워드는 일반적인 코드 블럭에서 지역 스코프로 동작하지 않기 때문에 중복 선언이나 초기화 등을 조심해야한다.

다음은 반복문의 예시이다.

```js
var i = 10;

for (var i = 0; i < 5; i++) {
  // i는 5까지 증가한다.
  console.log(i);
}

console.log(i); // 5
```

~~ES6에서 let, const를 만들만 했다.~~

## 13.5 렉시컬 스코프 Lexical Scope

렉시컬 스코프란 함수를 어디서 정의했는지에 따라 함수의 상위 스코프를 결정하는 것을 의미한다.

함수 정의가 실행되어 생성된 함수 객체는 결정된 상위 스코프를 기억한다.

다음 예시 코드를 이해하고 넘어가자.

```js
var x = 1;

function foo() {
  var x = 10;
  bar();
}

function bar() {
  console.log(x); // 이 x는 전역 변수 x에 바인딩되어 있다.
}

foo(); // 내부에서 bar를 호출해도 전역 변수 x 의 값이 찍힌다.

bar();
```

~~1,1~~
